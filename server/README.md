# Connect4 Web Server

A Node.js server that provides a web interface for the Connect4 game powered by SWI-Prolog.
Entirely generated by Anthropic Claude Sonnet 4.5 through Kilo Code.

## Features

- **REST API**: Complete game management API
- **Real-time Updates**: Live game state synchronization
- **Multiple Game Modes**: Human vs AI, AI vs AI configurations
- **Web Interface**: Clean, responsive UI for playing Connect4
- **Process Management**: Handles SWI-Prolog game instances

## Quick Start

### Prerequisites

- Node.js 18+ 
- SWI-Prolog installed
- npm or yarn

### Installation

```bash
# Install dependencies
npm install

# Start the server
npm start
```

The server will start on `http://localhost:3000`

### Docker Deployment

```bash
# Build and run with Docker
docker build -f ../Dockerfile.web -t connect4-web ..
docker run -p 3000:3000 connect4-web
```

## API Documentation

### Game Management

#### Start New Game
```http
POST /api/games
Content-Type: application/json

{
  "player1": "human",     // basic, minmax, random, human
  "player2": "minmax"     // basic, minmax, random, human
}
```

**Response:**
```json
{
  "message": "Game started",
  "game": {
    "id": "1640995200000",
    "player1": "human",
    "player2": "minmax",
    "status": "playing",
    "currentPlayer": "X",
    "board": [null, null, ...],
    "moveHistory": [],
    "waitingForHumanInput": true
  }
}
```

#### Get Game State
```http
GET /api/games/:id
```

#### Make a Move
```http
POST /api/games/:id/move
Content-Type: application/json

{
  "column": 3,    // 1-7
  "player": "X"   // X or Y
}
```

#### End Game
```http
DELETE /api/games/:id
```

#### List All Games
```http
GET /api/games
```

### Health Check
```http
GET /health
```

## Web Interface

Access the web interface at `http://localhost:3000`

Features:
- **Player Selection**: Choose AI types or human player
- **Interactive Board**: Click columns to drop pieces
- **Real-time Updates**: See game progress live
- **Move History**: Track all moves made
- **Game Status**: Current player and game state

## Game Flow

1. **Configuration**: Select player types (Human/AI)
2. **Initialization**: Server spawns SWI-Prolog process
3. **Gameplay**: 
   - AI moves happen automatically
   - Human moves wait for user input
   - Board updates in real-time
4. **Completion**: Game ends when someone wins or board is full

## Architecture

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Web Browser   │◄──►│  Node.js Server  │◄──►│ SWI-Prolog Game │
│   (HTML/JS)     │    │   (Express.js)   │    │   (Process)     │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌──────────────┐
                       │ Game State   │
                       │ Management   │
                       └──────────────┘
```

## Configuration

### Environment Variables

- `PORT`: Server port (default: 3000)
- `p1`: Default Player 1 type
- `p2`: Default Player 2 type

### Player Types

- `basic`: Basic AI implementation
- `minmax`: Minimax algorithm with alpha-beta pruning  
- `random`: Random move selection
- `human`: Waits for user input via API

## Error Handling

The API returns appropriate HTTP status codes:

- `200`: Success
- `400`: Bad Request (invalid input)
- `404`: Game not found
- `500`: Internal server error

Error responses include descriptive messages:
```json
{
  "error": "Column must be between 1 and 7"
}
```

## Development

### Running in Development Mode

```bash
npm run dev
```

Uses nodemon for automatic server restarts.

### Testing the API

```bash
# Start a new game
curl -X POST http://localhost:3000/api/games \
  -H "Content-Type: application/json" \
  -d '{"player1":"human","player2":"random"}'

# Check game status  
curl http://localhost:3000/api/games/1640995200000

# Make a move
curl -X POST http://localhost:3000/api/games/1640995200000/move \
  -H "Content-Type: application/json" \
  -d '{"column": 3, "player": "X"}'
```

## Deployment Considerations

- **Memory Management**: Clean up finished game processes
- **Session Storage**: Use Redis for production multi-instance deployments
- **Process Limits**: Set limits on concurrent games
- **Logging**: Implement structured logging for monitoring
- **Security**: Add rate limiting and input validation

## Troubleshooting

### Common Issues

1. **Port already in use**: Change PORT environment variable
2. **SWI-Prolog not found**: Ensure SWI-Prolog is installed and in PATH
3. **Permission denied**: Check file permissions for src/ directory
4. **Module not found**: Run `npm install` in server/ directory

### Logs

Check server logs for:
- Prolog process output
- Game state changes  
- API request/response details
- Error messages and stack traces
